# Progress Log

PRD: manifest
Started: 2026-01-20

## Codebase Patterns

- **DB enums**: Use `pgEnum` from drizzle-orm/pg-core, snake_case name, place in ENUMS section of schema.ts
- **DB tables**: Use `pgTable` with cuid2 id generation via `$defaultFn(() => createId())`
- **Relations**: Use `defineRelations` with RQB v2 API (r.many/r.one patterns)

---

## Task - db-1

- Added `manifestStatusEnum` with values: pending, active, running, completed, error
- Files changed: lib/services/db/schema.ts
- **Learnings:** Enums go in the ENUMS section around line 6-42

## Task - db-2

- Added `manifests` table with all required columns
- Files changed: lib/services/db/schema.ts (lines 193-220)
- Columns: id, projectId (FK), prdName, status (enum), spriteName, spriteUrl, spritePassword, webhookSecret, prdJson, errorMessage, createdAt, updatedAt, completedAt
- **Learnings:** Tables go in their own section; nullable columns need no `.notNull()`

## Task - db-3

- Added manifests to relations registry in `defineRelations`
- Added `projects.manifests: r.many.manifests` relation
- Added `manifests.project: r.one.projects` relation  
- Files changed: lib/services/db/schema.ts (lines 274-352)
- **Learnings:** Arrow function returning object needs `})` not just `}` before closing `defineRelations)`

## Task - db-4

- Generated migration via `pnpm db:generate`
- Applied migration via `pnpm drizzle-kit push` (no `db:migrate` script exists)
- `manifests` table created in database with all columns and FK constraint
- **Learnings:** Project uses `db:push` not `db:migrate`; `drizzle-kit migrate` requires journal tracking but project uses push workflow
